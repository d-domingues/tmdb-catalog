{"version":3,"file":"search-bar.js","sourceRoot":"","sources":["../../../src/components/search-bar.ts"],"names":[],"mappings":";AAAA,OAAO,wBAAwB,CAAC;AAEhC,OAAO,EAAE,MAAM,EAAE,MAAM,gBAAgB,CAAC;AACxC,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,MAAM,KAAK,CAAC;AACvC,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAC1E,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AACvD,OAAO,EAAE,MAAM,EAAE,MAAM,0BAA0B,CAAC;AAClD,OAAO,EAAE,QAAQ,EAAiB,MAAM,WAAW,CAAC;AAEpD,OAAO,EAAE,OAAO,EAAe,MAAM,+BAA+B,CAAC;AACrE,OAAO,EAAE,gBAAgB,EAAE,MAAM,gBAAgB,CAAC;AAClD,OAAO,EAAE,eAAe,EAAE,MAAM,wBAAwB,CAAC;AAGzD,IAAa,SAAS,GAAtB,MAAa,SAAU,SAAQ,UAAU;IAAzC;;QAG8B,UAAK,GAAG,EAAE,CAAC;QAC9B,YAAO,GAAkB,EAAE,CAAC;QAC5B,oBAAe,GAAG,KAAK,CAAC;QACxB,mBAAc,GAAG,CAAC,CAAC;IAgE9B,CAAC;IA3DC,YAAY;QACV,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,KAAK,EAAC,CAAC,EAAC,EAAE;;YACpC,MAAM,QAAQ,GAAG,MAAA,MAAA,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,0CAAE,KAAK,0CAAE,IAAI,EAAE,CAAC;YAC1C,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,gBAAgB,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QAClF,CAAC,EAAE,GAAG,CAAC,CAAC;IACV,CAAC;IAED,UAAU,CAAC,EAAiB;;QAC1B,IAAI,EAAE,CAAC,GAAG,KAAK,WAAW,EAAE;YAC1B,IAAI,CAAC,cAAc,GAAG,CAAC,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;YACtE,OAAO;SACR;QAED,IAAI,EAAE,CAAC,GAAG,KAAK,SAAS,EAAE;YACxB,IAAI,CAAC,cAAc;gBACjB,IAAI,CAAC,cAAc,KAAK,CAAC;oBACvB,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC;oBACzB,CAAC,CAAC,CAAC,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;YACtD,OAAO;SACR;QAED,MAAM,WAAW,GAAG,MAAA,MAAA,IAAI,CAAC,WAAW,0CAAE,KAAK,0CAAE,IAAI,EAAE,CAAC;QACpD,IAAI,EAAE,CAAC,GAAG,KAAK,OAAO,IAAI,WAAW,EAAE;YACrC,MAAM,CAAC,EAAE,CAAC,eAAe,WAAW,EAAE,CAAC,CAAC;SACzC;IACH,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAA;;;;iBAIE,IAAI,CAAC,KAAK;iBACV,CAAC,CAAM,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;iBAC/B,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;gBACpC,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;iBACnC,IAAI,CAAC,UAAU;;;;;gBAKhB,QAAQ,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;;UAErE,MAAM,CACN,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,EACf,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,CACZ,IAAI,CAAA;iCACiB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,EAAE;;6BAE7C,GAAG,KAAK,IAAI,CAAC,cAAc;0BAC9B,IAAI;;;aAGjB,CACJ;;KAEJ,CAAC;IACJ,CAAC;CACF,CAAA;AArEQ,gBAAM,GAAG,eAAe,CAAC;AAEJ;IAA3B,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;wCAAY;AAC9B;IAAR,KAAK,EAAE;0CAA6B;AAC5B;IAAR,KAAK,EAAE;kDAAyB;AACxB;IAAR,KAAK,EAAE;iDAAoB;AACJ;IAAvB,KAAK,CAAC,eAAe,CAAC;8CAAgC;AAP5C,SAAS;IADrB,aAAa,CAAC,YAAY,CAAC;GACf,SAAS,CAsErB;SAtEY,SAAS","sourcesContent":["import './suggestion-option.js';\r\n\r\nimport { Router } from '@vaadin/router';\r\nimport { html, LitElement } from 'lit';\r\nimport { customElement, property, query, state } from 'lit/decorators.js';\r\nimport { classMap } from 'lit/directives/class-map.js';\r\nimport { repeat } from 'lit/directives/repeat.js';\r\nimport { debounce, DebouncedFunc } from 'lodash-es';\r\n\r\nimport { isMovie, TmdbDataObj } from '../../models/tmdb-data-obj.js';\r\nimport { fetchSearchMulti } from '../tmdb.api.js';\r\nimport { searchBarStyles } from './search-bar.styles.js';\r\n\r\n@customElement('search-bar')\r\nexport class SearchBar extends LitElement {\r\n  static styles = searchBarStyles;\r\n\r\n  @property({ type: String }) value = '';\r\n  @state() results: TmdbDataObj[] = [];\r\n  @state() showSuggestions = false;\r\n  @state() currentSuggIdx = 0;\r\n  @query('#search-input') searchInput!: HTMLInputElement;\r\n\r\n  private handleInput!: DebouncedFunc<(e: any) => Promise<void>>;\r\n\r\n  firstUpdated() {\r\n    this.handleInput = debounce(async e => {\r\n      const queryTxt = e.path[0]?.value?.trim();\r\n      this.results = queryTxt ? (await fetchSearchMulti(queryTxt)).splice(0, 12) : [];\r\n    }, 400);\r\n  }\r\n\r\n  onkeyPress(ev: KeyboardEvent) {\r\n    if (ev.key === 'ArrowDown') {\r\n      this.currentSuggIdx = (this.currentSuggIdx + 1) % this.results.length;\r\n      return;\r\n    }\r\n\r\n    if (ev.key === 'ArrowUp') {\r\n      this.currentSuggIdx =\r\n        this.currentSuggIdx === 0\r\n          ? this.results.length - 1\r\n          : (this.currentSuggIdx - 1) % this.results.length;\r\n      return;\r\n    }\r\n\r\n    const searchQuery = this.searchInput?.value?.trim();\r\n    if (ev.key === 'Enter' && searchQuery) {\r\n      Router.go(`search-view/${searchQuery}`);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <input\r\n        id=\"search-input\"\r\n        placeholder=\"Buscar...\"\r\n        .value=${this.value}\r\n        @input=${(e: any) => this.handleInput(e)}\r\n        @focus=${() => (this.showSuggestions = true)}\r\n        @blur=${() => (this.showSuggestions = false)}\r\n        @keyup=${this.onkeyPress}\r\n      />\r\n\r\n      <div\r\n        id=\"suggestions\"\r\n        class=${classMap({ show: this.showSuggestions && this.results.length })}\r\n      >\r\n        ${repeat(\r\n          this.results,\r\n          item => item.id,\r\n          (item, idx) =>\r\n            html`\r\n              <a href=\"details/${isMovie(item) ? 'movie' : 'tv'}/${item.id}\">\r\n                <suggestion-option\r\n                  selected=${idx === this.currentSuggIdx}\r\n                  .item=${item}\r\n                ></suggestion-option>\r\n              </a>\r\n            `\r\n        )}\r\n      </div>\r\n    `;\r\n  }\r\n}\r\n"]}